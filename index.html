<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8">
<title>ржкрзНрж░рж╢рзНржиржкрждрзНрж░</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@font-face {
    font-family: 'SolaimanLipi';
    src: url('https://cdn.jsdelivr.net/gh/medialab/solaiman-lipi-font/SolaimanLipi.ttf') format('truetype');
}
body { font-family: 'SolaimanLipi', sans-serif; font-size:18px; margin:4px; padding:4px; color:#111; }

h2 { text-align:center; margin:8px; font-size:24px; font-weight:400; }

.print-btn, #saveJsonBtn, #loadJsonBtn, #addQuestion, #headingControl, #fontControl { display:inline-block; margin:4px; }
.print-btn, #saveJsonBtn, #loadJsonBtn, #pushToServerBtn { padding:6px 10px; border:none; border-radius:3px; cursor:pointer; font-size:16px; color:#fff; }

.print-btn, #saveJsonBtn, #loadJsonBtn { background:#0078d7; }
#pushToServerBtn { background:#28a745; }

.questions { column-count:2; column-gap:5px; margin:4px; }
.question { margin-bottom:8px; page-break-inside:avoid; font-weight:bold; position:relative; border:1px solid #ccc; padding:6px; }
.options { display:grid; grid-template-columns:1fr 1fr; gap:4px; margin-left:6px; font-weight:normal; }
.correct { color: darkblue; font-weight:bold; }
.delete-btn, .edit-btn { position:absolute; top:0; right:0; background:#e74c3c; color:#fff; border:none; border-radius:3px; padding:2px 6px; cursor:pointer; font-size:12px; margin-left:4px; }
.edit-btn { background:#f39c12; right:50px; }
#addQuestion, #headingControl, #fontControl { margin:10px 0; padding:10px; border:1px solid #ccc; }
#addQuestion input, #addQuestion select, #headingControl input, #fontControl input, #fontControl select { width:100%; margin:3px 0; padding:4px; }
#addQuestion button, #headingControl button, #fontControl button { padding:6px 10px; margin-top:6px; cursor:pointer; }

@media print {
    .print-btn, #addQuestion, .delete-btn, .edit-btn, #headingControl, #fontControl, #saveJsonBtn, #loadJsonBtn, #pushToServerBtn { display:none !important; }
    body{margin:0;padding:0;}
    .questions{column-count:2; column-gap:5px; margin:0;}
    .question{border:1px solid #000; padding:8px; margin:4px 0; page-break-inside:avoid;}
    .options div{font-weight:normal;}
}
</style>
</head>
<body>

<div id="headingControl">
    <label>ржкрзНрж░рж┐ржирзНржЯрзЗрж░ рж╣рзЗржбрж┐ржВ:</label>
    <input type="text" id="headingInput" placeholder="рж╣рзЗржбрж┐ржВ рж▓рж┐ржЦрзБржи" value="ржЖржорж╛рж░ ржкрзНрж░рж╢рзНржиржкрждрзНрж░">
    <button onclick="updateHeading()">рж╣рзЗржбрж┐ржВ рж╕рзЗржЯ ржХрж░рзБржи</button>
</div>

<div id="fontControl">
    <label>ржкрзНрж░рж╢рзНржирзЗрж░ ржлржирзНржЯ рж╕рж╛ржЗржЬ:</label>
    <input type="number" id="questionFontSize" value="18" min="10" max="36"> px
    <label>ржЕржкрж╢ржирзЗрж░ ржлржирзНржЯ рж╕рж╛ржЗржЬ:</label>
    <input type="number" id="optionFontSize" value="16" min="10" max="36"> px
    <label>ржлржирзНржЯ ржлрзНржпрж╛ржорж┐рж▓рж┐:</label>
    <select id="fontFamilySelect">
        <option value="SolaimanLipi">Solaiman Lipi</option>
        <option value="Arial">Arial</option>
        <option value="Tahoma">Tahoma</option>
        <option value="Times New Roman">Times New Roman</option>
    </select>
    <button onclick="applyFontSettings()">Apply Font</button>
</div>

<button class="print-btn" onclick="window.print()">ЁЯЦия╕П Print</button>
<button id="saveJsonBtn">ЁЯТ╛ JSON рж╕рзЗржн ржХрж░рзБржи</button>
<input type="file" id="loadJsonBtn" accept=".json">
<button id="pushToServerBtn">тШБя╕П рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржкрж╛ржарж╛ржи</button>

<u><h2 id="mainHeading">ржЖржорж╛рж░ ржкрзНрж░рж╢рзНржиржкрждрзНрж░</h2></u>

<div id="addQuestion">
    <h3>ржирждрзБржи ржкрзНрж░рж╢рзНржи ржПржб ржХрж░рзБржи</h3>
    <label>ржкрзНрж░рж╢рзНржи:</label><input type="text" id="manualText" required>
    <label>ржХ) ржЕржкрж╢ржи:</label><input type="text" id="optA" required>
    <label>ржЦ) ржЕржкрж╢ржи:</label><input type="text" id="optB" required>
    <label>ржЧ) ржЕржкрж╢ржи:</label><input type="text" id="optC" required>
    <label>ржШ) ржЕржкрж╢ржи:</label><input type="text" id="optD" required>
    <label>рж╕ржарж┐ржХ ржЙрждрзНрждрж░:</label>
    <select id="correctOpt">
        <option value="A">ржХ</option>
        <option value="B">ржЦ</option>
        <option value="C">ржЧ</option>
        <option value="D">ржШ</option>
    </select>
    <button id="addBtn">ржПржб ржХрж░рзБржи</button>
</div>

<div class="questions" id="questions"></div>

<script>
function toBengaliNum(num){const bn=['рзж','рзз','рзи','рзй','рзк','рзл','рзм','рзн','рзо','рзп']; return num.toString().split('').map(d=>bn[d]||d).join('');}
let questions = [];

window.addEventListener('load', () => {
    const savedQuestions = localStorage.getItem('questions');
    const savedHeading = localStorage.getItem('heading');
    if(savedQuestions) questions = JSON.parse(savedQuestions);
    if(savedHeading){ document.getElementById('mainHeading').innerText = savedHeading; document.getElementById('headingInput').value = savedHeading; }
    renderQuestions();

    fetch('/data.json')
        .then(res => res.json())
        .then(data => {
            if(data.heading){ document.getElementById('mainHeading').innerText=data.heading; document.getElementById('headingInput').value=data.heading; }
            if(data.questions){ questions=data.questions; renderQuestions(); }
        })
        .catch(err => console.log('Server JSON load failed:', err));
});

function renderQuestions(){
    const container=document.getElementById('questions'); container.innerHTML='';
    const qSize=document.getElementById('questionFontSize').value+"px";
    const oSize=document.getElementById('optionFontSize').value+"px";
    const fontFam=document.getElementById('fontFamilySelect').value;

    questions.forEach((q,idx)=>{
        const div=document.createElement('div'); div.className='question'; div.style.fontSize=qSize; div.style.fontFamily=fontFam;
        const labels=['ржХ','ржЦ','ржЧ','ржШ'];
        div.innerHTML=`${toBengaliNum(idx+1)}. ${q.text}<div class="options" style="font-size:${oSize}; font-family:${fontFam};">${q.option.map((opt,i)=>`<div class="${q.correct===['A','B','C','D'][i]?'correct':''}">${labels[i]}) ${opt}</div>`).join('')}</div><button class="edit-btn" onclick="editQuestion(${idx})">ржПржбрж┐ржЯ ржХрж░рзБржи</button><button class="delete-btn" onclick="deleteQuestion(${idx})">ржорзБржЫрзЗ ржлрзЗрж▓рзБржи</button>`;
        container.appendChild(div);
    });
    localStorage.setItem('questions', JSON.stringify(questions));
}

function deleteQuestion(idx){if(confirm('ржЖржкржирж┐ ржХрж┐ рж╕рждрзНржпрж┐ржЗ ржПржЗ ржкрзНрж░рж╢рзНржи ржорзБржЫрзЗ ржлрзЗрж▓рждрзЗ ржЪрж╛ржи?')){questions.splice(idx,1); renderQuestions();}}
function editQuestion(idx){const q=questions[idx]; const text=prompt("ржкрзНрж░рж╢рзНржи рж╕ржорзНржкрж╛ржжржирж╛ ржХрж░рзБржи:",q.text); if(text===null) return; const optA=prompt("ржХ) ржЕржкрж╢ржи:",q.option[0]); if(optA===null) return; const optB=prompt("ржЦ) ржЕржкрж╢ржи:",q.option[1]); if(optB===null) return; const optC=prompt("ржЧ) ржЕржкрж╢ржи:",q.option[2]); if(optC===null) return; const optD=prompt("ржШ) ржЕржкрж╢ржи:",q.option[3]); if(optD===null) return; const correct=prompt("рж╕ржарж┐ржХ ржЙрждрзНрждрж░ (A/B/C/D):",q.correct); if(correct===null) return; questions[idx]={text:text, option:[optA,optB,optC,optD], correct:correct.toUpperCase()}; renderQuestions();}

document.getElementById('addBtn').addEventListener('click',()=>{
    const text=document.getElementById('manualText').value.trim();
    const optA=document.getElementById('optA').value.trim();
    const optB=document.getElementById('optB').value.trim();
    const optC=document.getElementById('optC').value.trim();
    const optD=document.getElementById('optD').value.trim();
    const correct=document.getElementById('correctOpt').value;
    if(!text||!optA||!optB||!optC||!optD){alert('рж╕ржм ржлрж┐рж▓рзНржб ржкрзВрж░ржг ржХрж░рзБржи'); return;}
    questions.push({text:text, option:[optA,optB,optC,optD], correct:correct}); renderQuestions();
    document.getElementById('manualText').value=''; document.getElementById('optA').value=''; document.getElementById('optB').value=''; document.getElementById('optC').value=''; document.getElementById('optD').value='';
});

function updateHeading(){ const h=document.getElementById('headingInput').value.trim(); if(h){ document.getElementById('mainHeading').innerText=h; localStorage.setItem('heading',h); }}
function applyFontSettings(){ renderQuestions(); }

document.getElementById('saveJsonBtn').addEventListener('click', ()=>{
    const dataStr=JSON.stringify({heading:document.getElementById('mainHeading').innerText,questions:questions},null,2);
    const blob=new Blob([dataStr],{type:"application/json"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download="questions.json"; a.click(); URL.revokeObjectURL(url);
});

document.getElementById('loadJsonBtn').addEventListener('change',(e)=>{
    const file=e.target.files[0]; if(!file) return;
    const reader=new FileReader();
    reader.onload=function(event){
        try{ const data=JSON.parse(event.target.result);
        if(data.heading) document.getElementById('mainHeading').innerText=data.heading;
        if(data.questions) questions=data.questions;
        renderQuestions();
        }catch(err){alert("рж╕ржарж┐ржХ JSON ржлрж╛ржЗрж▓ ржиржпрж╝");}
    }
    reader.readAsText(file);
});

function pushToServer(){
    const payload={heading:document.getElementById('mainHeading').innerText, questions:questions};
    fetch("/upload",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(payload)})
    .then(res=>res.json()).then(r=>{ alert("рж╕ржлрж▓ржнрж╛ржмрзЗ рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржкрж╛ржарж╛ржирзЛ рж╣рзЯрзЗржЫрзЗ!"); console.log(r); })
    .catch(err=>{ alert("рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржкрж╛ржарж╛рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣рзЯрзЗржЫрзЗ"); console.error(err); });
}

document.getElementById('pushToServerBtn').addEventListener('click', pushToServer);
</script>

</body>
</html>
