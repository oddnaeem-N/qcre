<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8">
<title>PRINTEE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Solaiman Lipi Font -->
<style>
@font-face {
    font-family: 'SolaimanLipi';
    src: url('https://cdn.jsdelivr.net/gh/medialab/solaiman-lipi-font/SolaimanLipi.ttf') format('truetype');
}
body {
    font-family: 'SolaimanLipi', sans-serif;
    font-size: 18px;
    margin: 4px;
    padding: 4px;
    color: #111;
}

h2 { text-align: center; margin: 8px; font-size: 24px; font-weight: 400; }

.print-btn, #saveJsonBtn, #loadJsonBtn, #addQuestion, #headingControl, #fontControl { display: inline-block; margin: 4px; }
.print-btn, #saveJsonBtn, #loadJsonBtn { padding:6px 10px; background:#0078d7; color:#fff; border:none; border-radius:3px; cursor:pointer; font-size:16px; }

.questions {
    column-count: 2;
    column-gap: 5px;
    margin: 4px;
}
.question {
    margin-bottom: 8px;
    page-break-inside: avoid;
    font-weight: bold;
    position: relative;
    border: 1px solid #ccc;
    padding: 6px;
}
.options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4px;
    margin-left: 6px;
    font-weight: normal;
}

.correct { color: darkblue; font-weight: bold; }

.delete-btn, .edit-btn {
    position: absolute;
    top: 0;
    right: 0;
    background: #e74c3c;
    color: #fff;
    border: none;
    border-radius: 3px;
    padding: 2px 6px;
    cursor: pointer;
    font-size: 12px;
    margin-left: 4px;
}
.edit-btn { background:#f39c12; right: 50px; }

/* Add Question Form */
#addQuestion {
    margin:10px 0;
    padding:10px;
    border:1px solid #ccc;
}
#addQuestion input, #addQuestion select { width:100%; margin:3px 0; padding:4px; }
#addQuestion label { font-weight:500; }
#addQuestion button { padding:6px 10px; margin-top:6px; cursor:pointer; }

/* Pagination */
#pagination {
    text-align: center;
    margin: 10px 0;
}
#pagination button {
    padding: 6px 12px;
    margin: 4px;
    background: #444;
    color: #fff;
    border: none;
    border-radius: 3px;
    cursor: pointer;
}

/* MOBILE VIEW ‚Äî NEW */
@media (max-width: 600px) {
    .questions {
        column-count: 1 !important;
    }
}

/* Print CSS */
@media print {
    .print-btn,
    #addQuestion,
    .delete-btn,
    .edit-btn,
    #headingControl,
    #fontControl,
    #saveJsonBtn,
    #loadJsonBtn,
    #pagination {
        display: none !important;
    }

    body { margin:0; padding:0; }
    .questions { column-count: 2 !important; column-gap:5px; margin:0; }
    .question {
        border: 1px solid #000;
        padding: 8px;
        margin: 4px 0;
        page-break-inside: avoid;
    }
}
</style>
</head>
<body>

<div id="headingControl">
    <label>‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶π‡ßá‡¶°‡¶ø‡¶Ç:</label>
    <input type="text" id="headingInput" value="‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶™‡¶§‡ßç‡¶∞">
    <button onclick="updateHeading()">‡¶π‡ßá‡¶°‡¶ø‡¶Ç ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<div id="fontControl">
    <label>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú:</label>
    <input type="number" id="questionFontSize" value="18"> px
    <label>‡¶Ö‡¶™‡¶∂‡¶®‡ßá‡¶∞ ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú:</label>
    <input type="number" id="optionFontSize" value="16"> px
    <label>‡¶´‡¶®‡ßç‡¶ü ‡¶´‡ßç‡¶Ø‡¶æ‡¶Æ‡¶ø‡¶≤‡¶ø:</label>
    <select id="fontFamilySelect">
        <option value="SolaimanLipi">Solaiman Lipi</option>
        <option value="Arial">Arial</option>
        <option value="Tahoma">Tahoma</option>
        <option value="Times New Roman">Times New Roman</option>
    </select>
    <button onclick="applyFontSettings()">Apply Font</button>
</div>

<button class="print-btn" onclick="window.print()">üñ®Ô∏è Print</button>
<button id="saveJsonBtn">üíæ JSON ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
<input type="file" id="loadJsonBtn" accept=".json">

<u><h2 id="mainHeading">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶™‡¶§‡ßç‡¶∞</h2></u>

<div id="addQuestion">
    <h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶è‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
    <label>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®:</label>
    <input type="text" id="manualText">
    <label>‡¶ï) ‡¶Ö‡¶™‡¶∂‡¶®:</label><input type="text" id="optA">
    <label>‡¶ñ) ‡¶Ö‡¶™‡¶∂‡¶®:</label><input type="text" id="optB">
    <label>‡¶ó) ‡¶Ö‡¶™‡¶∂‡¶®:</label><input type="text" id="optC">
    <label>‡¶ò) ‡¶Ö‡¶™‡¶∂‡¶®:</label><input type="text" id="optD">
    <label>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞:</label>
    <select id="correctOpt">
        <option value="A">‡¶ï</option>
        <option value="B">‡¶ñ</option>
        <option value="C">‡¶ó</option>
        <option value="D">‡¶ò</option>
    </select>
    <button id="addBtn">‡¶è‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<div class="questions" id="questions"></div>

<div id="pagination">
    <button onclick="prevPage()">‚¨Ö ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡ßü‡¶æ‡¶∏</button>
    <span id="pageInfo"></span>
    <button onclick="nextPage()">‡¶®‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‚û°</button>
</div>

<script>

function toBengaliNum(num){
    const bn=['‡ß¶','‡ßß','‡ß®','‡ß©','‡ß™','‡ß´','‡ß¨','‡ß≠','‡ßÆ','‡ßØ'];
    return num.toString().split('').map(d=>bn[d]||d).join('');
}

let currentPage = 1;
const perPage = 10;
let questions = [];

// LOAD FROM LOCALSTORAGE
window.addEventListener('load', () => {
    const savedQuestions = localStorage.getItem('questions');
    const savedHeading = localStorage.getItem('heading');
    if(savedQuestions) questions = JSON.parse(savedQuestions);
    if(savedHeading){
        document.getElementById('mainHeading').innerText = savedHeading;
        document.getElementById('headingInput').value = savedHeading;
    }
    renderQuestions();
});

/* --- CHANGE #1: renderQuestions now supports showAll flag --- */
function renderQuestions(showAll = false){
    const container = document.getElementById('questions');
    container.innerHTML='';

    const qSize = document.getElementById('questionFontSize').value + "px";
    const oSize = document.getElementById('optionFontSize').value + "px";
    const fontFam = document.getElementById('fontFamilySelect').value;

    const start = (currentPage - 1) * perPage;
    const end = start + perPage;

    const display = showAll ? questions : questions.slice(start, end);

    display.forEach((q,realIdx)=>{
        const idx = showAll ? realIdx : start + realIdx;

        const div=document.createElement('div');
        div.className='question';
        div.style.fontSize=qSize;
        div.style.fontFamily=fontFam;

        const labels=['‡¶ï','‡¶ñ','‡¶ó','‡¶ò'];

        div.innerHTML = `${toBengaliNum(idx+1)}. ${q.text}
            <div class="options" style="font-size:${oSize}; font-family:${fontFam};">
            ${q.option.map((opt,i)=>{
                return `<div class="${q.correct===['A','B','C','D'][i]?'correct':''}">
                ${labels[i]}) ${opt}</div>`;
            }).join('')}
            </div>
            <button class="edit-btn" onclick="editQuestion(${idx})">‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button class="delete-btn" onclick="deleteQuestion(${idx})">‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</button>`;

        container.appendChild(div);
    });

    document.getElementById('pageInfo').innerText =
        `‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ${toBengaliNum(currentPage)} / ${toBengaliNum(Math.ceil(questions.length/perPage))}`;

    localStorage.setItem('questions', JSON.stringify(questions));
}

function prevPage(){
    if(currentPage>1){
        currentPage--;
        renderQuestions();
    }
}

function nextPage(){
    if(currentPage < Math.ceil(questions.length/perPage)){
        currentPage++;
        renderQuestions();
    }
}

function deleteQuestion(idx){
    if(confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø‡¶á ‡¶è‡¶á ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')){
        questions.splice(idx,1);
        if(currentPage > Math.ceil(questions.length/perPage)){
            currentPage--;
        }
        renderQuestions();
    }
}

function editQuestion(idx){
    const q=questions[idx];
    const text=prompt("‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶®‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®:", q.text);
    if(text===null) return;
    const optA=prompt("‡¶ï) ‡¶Ö‡¶™‡¶∂‡¶®:", q.option[0]); if(optA===null) return;
    const optB=prompt("‡¶ñ) ‡¶Ö‡¶™‡¶∂‡¶®:", q.option[1]); if(optB===null) return;
    const optC=prompt("‡¶ó) ‡¶Ö‡¶™‡¶∂‡¶®:", q.option[2]); if(optC===null) return;
    const optD=prompt("‡¶ò) ‡¶Ö‡¶™‡¶∂‡¶®:", q.option[3]); if(optD===null) return;
    const correct=prompt("‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞ (A/B/C/D):", q.correct); if(correct===null) return;

    questions[idx]={text:text, option:[optA,optB,optC,optD], correct:correct.toUpperCase()};
    renderQuestions();
}

document.getElementById('addBtn').addEventListener('click',()=>{
    const text=document.getElementById('manualText').value.trim();
    const optA=document.getElementById('optA').value.trim();
    const optB=document.getElementById('optB').value.trim();
    const optC=document.getElementById('optC').value.trim();
    const optD=document.getElementById('optD').value.trim();
    const correct=document.getElementById('correctOpt').value;

    if(!text||!optA||!optB||!optC||!optD){
        alert("‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®");
        return;
    }

    questions.push({text:text, option:[optA,optB,optC,optD], correct:correct});
    renderQuestions();

    document.getElementById('manualText').value='';
    document.getElementById('optA').value='';
    document.getElementById('optB').value='';
    document.getElementById('optC').value='';
    document.getElementById('optD').value='';
});

function updateHeading(){
    const h=document.getElementById('headingInput').value.trim();
    if(h){
        document.getElementById('mainHeading').innerText=h;
        localStorage.setItem('heading',h);
    }
}

function applyFontSettings(){
    renderQuestions();
}

// SAVE JSON
document.getElementById('saveJsonBtn').addEventListener('click',()=>{
    const dataStr=JSON.stringify({
        heading:document.getElementById('mainHeading').innerText,
        questions:questions
    },null,2);

    const blob=new Blob([dataStr],{type:"application/json"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url;
    a.download="questions.json";
    a.click();
    URL.revokeObjectURL(url);
});

// LOAD JSON
document.getElementById('loadJsonBtn').addEventListener('change',e=>{
    const file=e.target.files[0];
    if(!file) return;
    const reader=new FileReader();

    reader.onload=event=>{
        try{
            const data=JSON.parse(event.target.result);
            if(data.heading) document.getElementById('mainHeading').innerText=data.heading;
            if(data.questions) questions=data.questions;
            currentPage=1;
            renderQuestions();
        }catch(err){
            alert("‡¶∏‡¶†‡¶ø‡¶ï JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶Ø‡¶º");
        }
    }
    reader.readAsText(file);
});

/* --- CHANGE #2: PRINT ALWAYS SHOWS ALL QUESTIONS --- */
window.addEventListener("beforeprint", () => {
    renderQuestions(true);  // showAll mode for print
});

</script>

</body>
</html>
