<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8">
<title>PRINTEE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@font-face {
    font-family: 'SolaimanLipi';
    src: url('https://cdn.jsdelivr.net/gh/medialab/solaiman-lipi-font/SolaimanLipi.ttf') format('truetype');
}

body{
    font-family:SolaimanLipi,sans-serif;
    font-size:18px;
    margin:4px;
    color:#111;
}

h2{text-align:center;font-weight:400;}
h3{margin:6px 0;border-bottom:1px solid #000;}

.print-btn,#saveJsonBtn{
    padding:6px 10px;
    background:#0078d7;
    color:#fff;
    border:none;
    border-radius:3px;
    cursor:pointer;
    margin:4px;
}

.questions{column-count:2;column-gap:6px;}

.question{
    border:1px solid #ccc;
    margin-bottom:8px;
    padding:6px;
    position:relative;
    font-weight:bold;
    page-break-inside:avoid;
}

.options{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:4px;
    margin-left:6px;
    font-weight:normal;
}

.correct{color:darkblue;font-weight:bold;}

.edit-btn,.delete-btn{
    display:none;
    position:absolute;
    top:0;
    font-size:12px;
    border:none;
    border-radius:3px;
    color:#fff;
    cursor:pointer;
    padding:2px 6px;
}
.edit-btn{right:50px;background:#f39c12;}
.delete-btn{right:0;background:#e74c3c;}

.question.active .edit-btn,
.question.active .delete-btn{display:block;}

#addQuestion,.edit-form{
    border:1px solid #ccc;
    padding:10px;
    margin:10px 0;
}

input,select{
    width:100%;
    margin:4px 0;
    padding:4px;
}

@media(max-width:600px){
    .questions{column-count:1;}
}

@media print{
    .print-btn,#addQuestion,.edit-btn,.delete-btn,
    #saveJsonBtn,#loadJsonBtn,#pagination{display:none!important;}
}
</style>
</head>

<body>

<button class="print-btn" onclick="window.print()">üñ®Ô∏è Print</button>
<button id="saveJsonBtn">üíæ JSON ‡¶∏‡ßá‡¶≠</button>
<input type="file" id="loadJsonBtn" accept=".json">

<u><h2 id="mainHeading">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶™‡¶§‡ßç‡¶∞</h2></u>

<!-- ADD QUESTION -->
<div id="addQuestion">
<h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</h3>

<label>‡¶ü‡¶™‡¶ø‡¶ï:</label>
<input id="topicInput" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂">

<label>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®:</label>
<input id="qText">

<label>‡¶ï:</label><input id="optA">
<label>‡¶ñ:</label><input id="optB">
<label>‡¶ó:</label><input id="optC">
<label>‡¶ò:</label><input id="optD">

<label>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞:</label>
<select id="correctOpt">
<option value="A">‡¶ï</option>
<option value="B">‡¶ñ</option>
<option value="C">‡¶ó</option>
<option value="D">‡¶ò</option>
</select>

<button onclick="addQuestion()">‡¶è‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<div class="questions" id="questions"></div>

<div id="pagination" style="text-align:center;">
<button onclick="prevPage()">‚¨Ö</button>
<span id="pageInfo"></span>
<button onclick="nextPage()">‚û°</button>
</div>

<script>
function bn(n){
    const b=['‡ß¶','‡ßß','‡ß®','‡ß©','‡ß™','‡ß´','‡ß¨','‡ß≠','‡ßÆ','‡ßØ'];
    return n.toString().split('').map(x=>b[x]||x).join('');
}

let questions=[];
let currentPage=1;
let perPage=10;

/* LOAD FROM LOCAL */
window.onload=()=>{
    const saved=localStorage.getItem("questions");
    if(saved){
        questions=JSON.parse(saved).map(q=>({
            text:q.text,
            option:q.option,
            correct:q.correct,
            topic:q.topic||"‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø"
        }));
    }
    render();
};

/* RENDER */
function render(showAll=false){
    const box=document.getElementById("questions");
    box.innerHTML="";

    const start=(currentPage-1)*perPage;
    const list=showAll?questions:questions.slice(start,start+perPage);

    const grouped={};
    list.forEach((q,i)=>{
        const t=q.topic||"‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø";
        if(!grouped[t]) grouped[t]=[];
        grouped[t].push({q,i});
    });

    Object.keys(grouped).forEach(topic=>{
        const h=document.createElement("h3");
        h.innerText=topic;
        box.appendChild(h);

        grouped[topic].forEach(({q,i})=>{
            const idx=showAll?i:start+i;
            const d=document.createElement("div");
            d.className="question";

            d.onclick=()=>{
                document.querySelectorAll(".question").forEach(x=>x.classList.remove("active"));
                d.classList.add("active");
            };

            const L=['‡¶ï','‡¶ñ','‡¶ó','‡¶ò'];
            d.innerHTML=`
            ${bn(idx+1)}. ${q.text}
            <div class="options">
            ${q.option.map((o,j)=>`
            <div class="${q.correct===['A','B','C','D'][j]?'correct':''}">
            ${L[j]}) ${o}</div>`).join("")}
            </div>
            <button class="edit-btn" onclick="editQ(${idx},this)">‡¶è‡¶°‡¶ø‡¶ü</button>
            <button class="delete-btn" onclick="delQ(${idx})">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
            `;
            box.appendChild(d);
        });
    });

    pageInfo.innerText=`‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ${bn(currentPage)}`;
    localStorage.setItem("questions",JSON.stringify(questions));
}

/* ADD */
function addQuestion(){
    questions.push({
        topic:topicInput.value.trim()||"‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø",
        text:qText.value.trim(),
        option:[optA.value,optB.value,optC.value,optD.value],
        correct:correctOpt.value
    });
    topicInput.value=qText.value=optA.value=optB.value=optC.value=optD.value="";
    render();
}

/* EDIT */
function editQ(i,b){
    const q=questions[i];
    const p=b.parentNode;
    if(p.querySelector(".edit-form")) return;

    const f=document.createElement("div");
    f.className="edit-form";
    f.innerHTML=`
    <input value="${q.topic}">
    <input value="${q.text}">
    <input value="${q.option[0]}">
    <input value="${q.option[1]}">
    <input value="${q.option[2]}">
    <input value="${q.option[3]}">
    <select>
      <option value="A">‡¶ï</option>
      <option value="B">‡¶ñ</option>
      <option value="C">‡¶ó</option>
      <option value="D">‡¶ò</option>
    </select>
    <button onclick="saveEdit(${i},this)">Save</button>
    `;
    p.appendChild(f);
}

/* SAVE EDIT */
function saveEdit(i,b){
    const f=b.parentNode;
    questions[i]={
        topic:f.children[0].value||"‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø",
        text:f.children[1].value,
        option:[f.children[2].value,f.children[3].value,f.children[4].value,f.children[5].value],
        correct:f.children[6].value
    };
    render();
}

/* DELETE */
function delQ(i){
    if(confirm("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")){
        questions.splice(i,1);
        render();
    }
}

/* PAGINATION */
function prevPage(){if(currentPage>1){currentPage--;render();}}
function nextPage(){currentPage++;render();}

/* SAVE JSON */
saveJsonBtn.onclick=()=>{
    const blob=new Blob([JSON.stringify({questions},null,2)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="questions.json";
    a.click();
};

/* LOAD JSON (BACKWARD COMPATIBLE) */
loadJsonBtn.onchange=e=>{
    const file=e.target.files[0];
    if(!file) return;
    const r=new FileReader();
    r.onload=ev=>{
        try{
            const data=JSON.parse(ev.target.result);
            if(Array.isArray(data.questions)){
                questions=data.questions.map(q=>({
                    text:q.text,
                    option:q.option,
                    correct:q.correct,
                    topic:q.topic||"‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø"
                }));
                currentPage=1;
                render();
            }
        }catch{
            alert("Invalid JSON");
        }
    };
    r.readAsText(file);
};

/* PRINT */
window.addEventListener("beforeprint",()=>render(true));
</script>

</body>
</html>
