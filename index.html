<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8">
<title>PRINTEE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@font-face {
    font-family: 'SolaimanLipi';
    src: url('https://cdn.jsdelivr.net/gh/medialab/solaiman-lipi-font/SolaimanLipi.ttf') format('truetype');
}

body {
    font-family: 'SolaimanLipi', sans-serif;
    font-size: 18px;
    margin: 4px;
    color: #111;
}

.main-heading{
    text-align:center;
    font-size:24px;
    font-weight:500;
    text-decoration:none;
    margin:8px 0;
    background-color: #8fd19e;
    color: #fff;
    padding: 8px;
    border-radius: 5px;
}

.print-btn, #saveJsonBtn, #loadJsonBtn,
#addQuestion, #headingControl,
#fontControl, #perPageControl {
    margin: 4px;
}

.print-btn, #saveJsonBtn {
    padding:6px 10px;
    background:#0078d7;
    color:#fff;
    border:none;
    border-radius:3px;
    cursor:pointer;
    font-size:16px;
}

.questions {
    column-count: 2;
    column-gap: 6px;
}

.question {
    margin-bottom: 8px;
    page-break-inside: avoid;
    font-weight: bold;
    position: relative;
    border: 1px solid #ccc;
    padding: 6px;
}

.topic-title{
    font-weight:bold;
    margin:6px 0;
    border-bottom:1px solid #000;
    text-align:center;
    background-color: #8fd19e;
    color: #fff;
    padding: 6px;
    border-radius: 4px;
}

.delete-btn, .edit-btn {
    display: none;
    position: absolute;
    top: 0;
    background: #e74c3c;
    color: #fff;
    border: none;
    border-radius: 3px;
    padding: 2px 6px;
    cursor: pointer;
    font-size: 12px;
}
.edit-btn { background:#f39c12; right: 50px; }
.delete-btn { right: 0; }

.question.active .delete-btn,
.question.active .edit-btn {
    display: block;
}

.options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4px;
    margin-left: 6px;
    font-weight: normal;
}

.correct { color: darkblue; font-weight: bold; }

#addQuestion input, #addQuestion select,
.edit-form input, .edit-form select {
    width:100%;
    margin:3px 0;
    padding:4px;
}

.edit-form {
    margin-top:10px;
    padding:10px;
    background:#f7f7f7;
    border:1px solid #bbb;
}

#pagination { text-align:center; margin:10px 0; }

@media (max-width: 600px) {
    .questions { column-count: 1 !important; }
}

@media print {
    .print-btn, #addQuestion, .delete-btn, .edit-btn,
    #headingControl, #fontControl, #saveJsonBtn,
    #loadJsonBtn, #pagination, #perPageControl,
    .edit-form {
        display: none !important;
    }

    .main-heading {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }

    .topic-title {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
}
</style>
</head>

<body>

<div id="headingControl">
    <label>‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶π‡ßá‡¶°‡¶ø‡¶Ç:</label>
    <input type="text" id="headingInput" value="‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶™‡¶§‡ßç‡¶∞">
    <button onclick="updateHeading()">‡¶π‡ßá‡¶°‡¶ø‡¶Ç ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<div id="fontControl">
    ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶´‡¶®‡ßç‡¶ü:
    <input type="number" id="questionFontSize" value="18"> px
    ‡¶Ö‡¶™‡¶∂‡¶® ‡¶´‡¶®‡ßç‡¶ü:
    <input type="number" id="optionFontSize" value="16"> px
    <select id="fontFamilySelect">
        <option value="SolaimanLipi">Solaiman Lipi</option>
        <option value="Arial">Arial</option>
        <option value="Tahoma">Tahoma</option>
    </select>
    <button onclick="applyFontSettings()">Apply</button>
</div>

<div id="perPageControl">
    ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶™‡ßá‡¶ú‡ßá ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®:
    <input type="number" id="perPageInput" value="10" style="width:70px;">
    <button onclick="updatePerPage()">Set</button>
</div>

<button class="print-btn" onclick="window.print()">üñ®Ô∏è Print</button>
<button id="saveJsonBtn">üíæ JSON ‡¶∏‡ßá‡¶≠</button>
<input type="file" id="loadJsonBtn" accept=".json">

<h2 id="mainHeading" class="main-heading">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶™‡¶§‡ßç‡¶∞</h2>

<div id="addQuestion">
<h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</h3>

<label>‡¶ü‡¶™‡¶ø‡¶ï:</label>
<select id="topicSelect" onchange="showCustomTopicInput()">
    <option value="‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</option>
    <option value="‡¶ó‡¶£‡¶ø‡¶§">‡¶ó‡¶£‡¶ø‡¶§</option>
    <option value="‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø">‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø</option>
    <option value="custom">‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶™‡¶ø‡¶ï...</option>
</select>
<input type="text" id="customTopicInput" style="display:none;" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡¶™‡¶ø‡¶ï ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">

<label>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®:</label>
<input type="text" id="manualText">

<label>‡¶ï:</label><input id="optA">
<label>‡¶ñ:</label><input id="optB">
<label>‡¶ó:</label><input id="optC">
<label>‡¶ò:</label><input id="optD">

<label>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞:</label>
<select id="correctOpt">
    <option value="A">‡¶ï</option>
    <option value="B">‡¶ñ</option>
    <option value="C">‡¶ó</option>
    <option value="D">‡¶ò</option>
</select>

<button id="addBtn">‡¶è‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<div class="questions" id="questions"></div>

<div id="pagination">
    <button onclick="prevPage()">‚¨Ö ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡ßü‡¶æ‡¶∏</button>
    <span id="pageInfo"></span>
    <button onclick="nextPage()">‡¶®‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‚û°</button>
</div>

<script>
function toBengaliNum(num){
    const bn=['‡ß¶','‡ßß','‡ß®','‡ß©','‡ß™','‡ß´','‡ß¨','‡ß≠','‡ßÆ','‡ßØ'];
    return num.toString().split('').map(d=>bn[d]||d).join('');
}

let currentPage = 1;
let perPage = 10;
let questions = [];

/* LOAD */
window.onload = () => {
    const saved = localStorage.getItem("questions");
    const heading = localStorage.getItem("heading");
    const per = localStorage.getItem("perPage");

    if(saved){
        questions = JSON.parse(saved).map(q=>({
            text:q.text,
            option:q.option,
            correct:q.correct,
            topic:q.topic || "‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø"
        }));
    }
    if(heading){
        mainHeading.innerText = heading;
        headingInput.value = heading;
    }
    if(per){
        perPage = Number(per);
        perPageInput.value = perPage;
    }
    renderQuestions();
};

/* SHOW CUSTOM TOPIC INPUT */
function showCustomTopicInput(){
    const sel = document.getElementById("topicSelect");
    const input = document.getElementById("customTopicInput");
    if(sel.value === "custom"){
        input.style.display = "inline-block";
        input.value = "";
    } else {
        input.style.display = "none";
    }
}

/* RENDER */
function renderQuestions(showAll=false){
    const box = document.getElementById("questions");
    box.innerHTML = "";

    const qSize = questionFontSize.value + "px";
    const oSize = optionFontSize.value + "px";
    const font = fontFamilySelect.value;

    const start = (currentPage-1)*perPage;
    const slice = showAll ? questions : questions.slice(start,start+perPage);

    const grouped = {};
    slice.forEach((q,i)=>{
        const realIndex = showAll ? i : start + i;
        const t = q.topic || "‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø";
        if(!grouped[t]) grouped[t]=[];
        grouped[t].push({q, realIndex});
    });

    Object.keys(grouped).forEach(topic=>{
        const h=document.createElement("div");
        h.className="topic-title";
        h.innerText=topic;
        box.appendChild(h);

        grouped[topic].forEach(({q, realIndex})=>{
            const d=document.createElement("div");
            d.className="question";
            d.style.fontSize=qSize;
            d.style.fontFamily=font;

            d.onclick=()=>{
                document.querySelectorAll(".question").forEach(x=>x.classList.remove("active"));
                d.classList.add("active");
            };

            const L=['‡¶ï','‡¶ñ','‡¶ó','‡¶ò'];
            d.innerHTML=`
            ${toBengaliNum(realIndex+1)}. ${q.text}
            <div class="options" style="font-size:${oSize}">
            ${q.option.map((o,j)=>`
                <div class="${q.correct===['A','B','C','D'][j]?'correct':''}">
                ${L[j]}) ${o}</div>`).join("")}
            </div>
            <button class="edit-btn" onclick="showEditForm(${realIndex},this)">‡¶è‡¶°‡¶ø‡¶ü</button>
            <button class="delete-btn" onclick="deleteQuestion(${realIndex})">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
            `;
            box.appendChild(d);
        });
    });

    pageInfo.innerText =
        `‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ${toBengaliNum(currentPage)} / ${toBengaliNum(Math.ceil(questions.length/perPage))}`;

    localStorage.setItem("questions",JSON.stringify(questions));
}

/* ADD */
addBtn.onclick=()=>{
    let topic;
    if(topicSelect.value === "custom" && customTopicInput.value.trim() !== ""){
        topic = customTopicInput.value.trim();
        const opt = document.createElement("option");
        opt.value = topic;
        opt.text = topic;
        topicSelect.insertBefore(opt, topicSelect.lastElementChild);
        topicSelect.value = topic;
        customTopicInput.style.display = "none";
    } else {
        topic = topicSelect.value;
    }

    questions.push({
        text:manualText.value,
        option:[optA.value,optB.value,optC.value,optD.value],
        correct:correctOpt.value,
        topic:topic || "‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø"
    });

    manualText.value=optA.value=optB.value=optC.value=optD.value="";
    renderQuestions();
};

/* EDIT */
function showEditForm(idx, btn){
    const q=questions[idx];
    const parent=btn.closest(".question");
    if(parent.querySelector(".edit-form")) return;

    const f=document.createElement("div");
    f.className="edit-form";
    f.innerHTML=`
        <label>‡¶ü‡¶™‡¶ø‡¶ï:</label>
        <input id="eTopic" value="${q.topic}">
        <label>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®:</label>
        <input id="eText" value="${q.text}">
        <input id="eA" value="${q.option[0]}">
        <input id="eB" value="${q.option[1]}">
        <input id="eC" value="${q.option[2]}">
        <input id="eD" value="${q.option[3]}">
        <select id="eCorrect">
            <option value="A">‡¶ï</option>
            <option value="B">‡¶ñ</option>
            <option value="C">‡¶ó</option>
            <option value="D">‡¶ò</option>
        </select>
        <button onclick="saveEdit(${idx},this)">Save</button>
        <button onclick="this.parentNode.remove()">Cancel</button>
    `;
    parent.appendChild(f);
}

function saveEdit(idx,btn){
    const f=btn.parentNode;
    questions[idx]={
        topic:f.querySelector("#eTopic").value,
        text:f.querySelector("#eText").value,
        option:[
            f.querySelector("#eA").value,
            f.querySelector("#eB").value,
            f.querySelector("#eC").value,
            f.querySelector("#eD").value
        ],
        correct:f.querySelector("#eCorrect").value
    };
    renderQuestions();
}

/* DELETE */
function deleteQuestion(idx){
    if(confirm("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")){
        questions.splice(idx,1);
        renderQuestions();
    }
}

/* OTHERS */
function updateHeading(){
    const h=headingInput.value.trim();
    if(h){
        mainHeading.innerText=h;
        localStorage.setItem("heading",h);
    }
}
function applyFontSettings(){ renderQuestions(); }
function updatePerPage(){
    perPage=Number(perPageInput.value)||1;
    localStorage.setItem("perPage",perPage);
    currentPage=1;
    renderQuestions();
}
function prevPage(){ if(currentPage>1){currentPage--;renderQuestions();} }
function nextPage(){
    if(currentPage<Math.ceil(questions.length/perPage)){
        currentPage++;renderQuestions();
    }
}

/* JSON SAVE */
saveJsonBtn.onclick=()=>{
    const blob=new Blob([JSON.stringify({
        heading:mainHeading.innerText,
        questions
    },null,2)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="questions.json";
    a.click();
};

/* JSON LOAD */
loadJsonBtn.onchange=e=>{
    const f=e.target.files[0];
    if(!f) return;
    const r=new FileReader();
    r.onload=ev=>{
        try{
            const data=JSON.parse(ev.target.result);
            if(data.heading){
                mainHeading.innerText=data.heading;
                headingInput.value=data.heading;
            }
            if(Array.isArray(data.questions)){
                questions=data.questions.map(q=>({
                    text:q.text,
                    option:q.option,
                    correct:q.correct,
                    topic:q.topic||"‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø"
                }));
                currentPage=1;
                renderQuestions();
            }
        }catch{ alert("Invalid JSON"); }
    };
    r.readAsText(f);
};

window.addEventListener("beforeprint",()=>renderQuestions(true));
</script>

</body>
</html>
