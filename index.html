<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Quiz Sheet Builder</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Tiro+Bangla&display=swap" rel="stylesheet">

<style>
body {
  font-family: "Tiro Bangla", sans-serif;
  background: #fff;
  margin: 0;
  padding: 0;
  position: relative;
}

.exam-title {
  text-align: center;
  font-weight: bold;
  padding: 2px 2px;
  margin: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.app-header {
  background: #fff;
  border-bottom: 1px solid #dee2e6;
  position: sticky;
  top: 0;
  z-index: 100;
  padding: 0.25rem;
}

.section-wrapper {
  page-break-inside: avoid;
}

.section-block {
  text-align: center;
  font-weight: bold;
  background: #e9ecef;
  margin-top: 10px;
  margin-bottom: 4px;
  padding: 4px 2px;
  border: 1px solid #ccc;
}

.question-card {
  border: 1px solid #000;
  margin: 2px;
  padding: 2px;
  page-break-inside: avoid;
}

.question-header {
  font-weight: bold;
  margin: 0;
  padding: 4px 2px;
  background: #f8f9fa;
  border-bottom: 1px solid #ddd;
}

.options-list {
  display: flex;
  flex-wrap: wrap;
  list-style: none;
  margin: 2px 0;
  padding-left: 0;
  gap: 10px;
}

.options-list li {
  margin: 0;
  padding: 0 2px;
  flex: 1 1 45%;
}

.answer-line {
  font-weight: bold;
  margin: 2px 0;
  padding: 2px;
}

.explanation {
  margin: 2px 0;
  padding: 2px;
  color: #6c757d;
}

.empty-state {
  border: 1px dashed #dee2e6;
  padding: 0.5rem;
  text-align: center;
  color: #6c757d;
}

.watermark {
  position: fixed;
  top: 40%;
  left: 20%;
  font-size: 80px;
  color: rgba(0,0,0,0.1);
  transform: rotate(-30deg);
  z-index: 0;
  pointer-events: none;
}

@media print {
  @page { size: A4; margin: 0; }
  .app-header, .toolbar, .empty-state, footer { display: none !important; }
  body { background: #fff; }
  .exam-title { page-break-after: avoid; }
  .section-wrapper { page-break-inside: avoid; }
  .section-block, .question-card { page-break-inside: avoid; }
  .page-break { page-break-after: always; }
  .watermark { display: block; }
}
</style>
</head>

<body>

<div id="examTitle" class="exam-title">[Enter Exam Name]</div>
<div class="watermark" id="watermark" style="display:none;">WATERMARK</div>

<div class="app-header d-flex justify-content-between align-items-center">
  <h1 class="h6 mb-0">Quiz Sheet Builder</h1>
  <div class="toolbar d-flex gap-1">
    <button id="setExamBtn" class="btn btn-info btn-sm">Set Exam Name</button>
    <button id="addBtn" class="btn btn-primary btn-sm">Add</button>
    <button id="printBtn" class="btn btn-secondary btn-sm">Print</button>
    <button id="clearBtn" class="btn btn-outline-danger btn-sm">Clear</button>
    <button id="toggleWatermark" class="btn btn-warning btn-sm">Toggle Watermark</button>
  </div>
</div>

<main class="container-fluid p-0">
  <div id="questionsRoot"></div>
  <div id="emptyState" class="empty-state">
    <p>No questions yet.</p>
    <button id="startAddBtn" class="btn btn-primary btn-sm">Add question</button>
  </div>
</main>

<footer class="container-fluid p-0">
  <p class="text-muted small text-center m-1">
    Prints 5 questions per A4 page. Explanations auto-size for readability.
  </p>
</footer>

<script>
const STORE_KEY = "quizItems";
const TITLE_KEY = "examTitle";
let quizItems = [];

const rootEl = document.getElementById("questionsRoot");
const emptyEl = document.getElementById("emptyState");
const examTitleEl = document.getElementById("examTitle");
const watermarkEl = document.getElementById("watermark");

document.getElementById("addBtn").onclick = promptAddQuestion;
document.getElementById("startAddBtn").onclick = promptAddQuestion;
document.getElementById("printBtn").onclick = () => window.print();
document.getElementById("clearBtn").onclick = clearAll;
document.getElementById("setExamBtn").onclick = setExamName;
document.getElementById("toggleWatermark").onclick = () => {
  watermarkEl.style.display = watermarkEl.style.display==='none'?'block':'none';
};

function loadItems() {
  try { quizItems = JSON.parse(localStorage.getItem(STORE_KEY)) || []; } 
  catch { quizItems = []; }
  const title = localStorage.getItem(TITLE_KEY);
  if (title) examTitleEl.textContent = title;
}

function saveItems() { localStorage.setItem(STORE_KEY, JSON.stringify(quizItems)); }

function setExamName() {
  const name = prompt("Enter Exam Name:");
  if (name !== null) {
    examTitleEl.textContent = name.trim();
    localStorage.setItem(TITLE_KEY, name.trim());
  }
}

function clearAll() {
  if (confirm("Clear all questions?")) {
    localStorage.removeItem(STORE_KEY);
    quizItems = [];
    render();
  }
}

function promptAddQuestion() {
  // Section dropdown
  let sections = [...new Set(quizItems.map(q=>q.section))];
  sections.unshift("New Section");

  let section;
  if(sections.length>1){
    let sel = prompt("Select Section:\n" + sections.map((s,i)=>i+1 + ". " + s).join("\n"), "1");
    if(sel===null) return;
    let idx = parseInt(sel)-1;
    if(idx===0){
      section = prompt("Enter new section name:");
      if(section===null) return;
    } else {
      section = sections[idx];
    }
  } else {
    section = prompt("Enter Section Name:");
    if(section===null) return;
  }

  const question = prompt("Question:"); if(question===null) return;
  const o1 = prompt("Option 1:"); if(o1===null) return;
  const o2 = prompt("Option 2:"); if(o2===null) return;
  const o3 = prompt("Option 3:"); if(o3===null) return;
  const o4 = prompt("Option 4:"); if(o4===null) return;
  const correct = prompt("Correct option number (1-4):"); 
  if(!["1","2","3","4"].includes(correct)) return;
  const explanation = prompt("Explanation:")??"";

  const newPage = confirm("Start this section on a new page?");

  quizItems.push({
    section: section.trim(),
    question: question.trim(),
    options: [o1.trim(), o2.trim(), o3.trim(), o4.trim()],
    correctIndex: Number(correct)-1,
    explanation: explanation.trim(),
    newPage: newPage
  });

  saveItems();
  render();
}

function explanationClass(text) {
  const len = text.length;
  if(len<=120) return "explain-large";
  if(len<=220) return "explain-medium";
  return "explain-small";
}

function render() {
  rootEl.innerHTML = "";
  if(!quizItems.length){ emptyEl.style.display=""; return; }
  emptyEl.style.display = "none";

  let lastSection="";
  quizItems.forEach((item,idx)=>{
    const serial = `প্রশ্ন–${idx+1}`;

    // Section wrapper
    if(item.section!==lastSection){
      lastSection = item.section;
      const wrapper = document.createElement("div");
      wrapper.className = "section-wrapper";
      if(item.newPage) wrapper.style.pageBreakBefore="always";

      const sec = document.createElement("div");
      sec.className="section-block";
      sec.textContent=item.section;
      wrapper.appendChild(sec);
      rootEl.appendChild(wrapper);
    }

    const wrapperDivs=rootEl.getElementsByClassName("section-wrapper");
    const wrapper=wrapperDivs[wrapperDivs.length-1];

    // Question card
    const card=document.createElement("article");
    card.className="question-card";

    const header=document.createElement("div");
    header.className="question-header";
    header.textContent=serial;
    card.appendChild(header);

    const qText=document.createElement("div");
    qText.textContent=item.question;
    qText.style.padding="2px";
    card.appendChild(qText);

    const ul=document.createElement("ul");
    ul.className="options-list";
    const labels=["(ক)","(খ)","(গ)","(ঘ)"];
    item.options.forEach((op,i)=>{
      const li=document.createElement("li");
      li.textContent=`${labels[i]} ${op}`;
      ul.appendChild(li);
    });
    card.appendChild(ul);

    const ans=document.createElement("div");
    ans.className="answer-line";
    ans.textContent=`সঠিক উত্তর: ${labels[item.correctIndex]} ${item.options[item.correctIndex]}`;
    card.appendChild(ans);

    const expl=document.createElement("div");
    expl.className=`explanation ${explanationClass(item.explanation)}`;
    expl.textContent=`ব্যাখ্যা: ${item.explanation}`;
    card.appendChild(expl);

    wrapper.appendChild(card);
  });
}

loadItems();
render();
</script>

</body>
</html>
